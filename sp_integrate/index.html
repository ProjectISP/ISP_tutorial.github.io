<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://projectisp.github.io/ISP_tutorial.github.io/sp_integrate/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Integrate & Differenciate - ISP Tutorial</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/color-brewer.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">ISP Tutorial</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="nav-item">
                                <a href="../basics/" class="nav-link">Start with the basics</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Modules</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../el/" class="dropdown-item">Earthquake Location</a>
</li>
                                    
<li>
    <a href="../tf/" class="dropdown-item">Time-Frequency Analysis</a>
</li>
                                    
<li>
    <a href="../mti/" class="dropdown-item">Seismic Moment Tensor Inversion</a>
</li>
                                    
<li>
    <a href="../aa/" class="dropdown-item">Array Analysis</a>
</li>
                                    
<li>
    <a href="../rf/" class="dropdown-item">Receiver Functions</a>
</li>
                                    
<li>
    <a href="../ant/" class="dropdown-item">Ambient Noise Tomography</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Additional Toolboxes</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../db/" class="dropdown-item">Database</a>
</li>
                                    
<li>
    <a href="../rd/" class="dropdown-item">Retrieve Data</a>
</li>
                                    
<li>
    <a href="../ppsds/" class="dropdown-item">PPSDs</a>
</li>
                                    
<li>
    <a href="../synth/" class="dropdown-item">Synthetic Generator</a>
</li>
                                    
<li>
    <a href="../nrt/" class="dropdown-item">Near Real Time Adquisition</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Signal Processing</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../sp_filtering/" class="dropdown-item">Basic Processing Tools</a>
</li>
                                    
<li>
    <a href="../remove_response/" class="dropdown-item">Remove Instrument Response</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Integrate & Differenciate</a>
</li>
                                    
<li>
    <a href="../smoothing/" class="dropdown-item">Smoothing</a>
</li>
                                    
<li>
    <a href="../sp_denoising/" class="dropdown-item">Denoising</a>
</li>
                                    
<li>
    <a href="../noise_processing/" class="dropdown-item">Noise Processing</a>
</li>
                                    
<li>
    <a href="../resample/" class="dropdown-item">Resampling</a>
</li>
                                    
<li>
    <a href="../macro/" class="dropdown-item">Macro</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../progress/" class="nav-link">Gallery & Progress</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">About</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../refs/" class="dropdown-item">References</a>
</li>
                                    
<li>
    <a href="../license.md" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../release_notes/" class="dropdown-item">Release Notes</a>
</li>
                                    
<li>
    <a href="../FAQs.md" class="dropdown-item">FAQs</a>
</li>
                                    
<li>
    <a href="../Special_Thanks/" class="dropdown-item">The Developer Team of ISP thanks to:</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../remove_response/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../smoothing/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#numerical-integration-and-differentiation" class="nav-link">Numerical Integration and Differentiation</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#numerical-integration" class="nav-link">Numerical Integration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#numerical-differentiation" class="nav-link">Numerical Differentiation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#frequency-domain-operations" class="nav-link">Frequency Domain Operations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#preprocessing-recommendations" class="nav-link">Preprocessing Recommendations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#summary-table" class="nav-link">Summary Table</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#which-integration-method-should-you-use" class="nav-link">Which Integration Method Should You Use?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#recommendation-table" class="nav-link">Recommendation Table</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pro-tip" class="nav-link">Pro Tip</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="numerical-integration-and-differentiation">Numerical Integration and Differentiation</h1>
<h2 id="introduction">Introduction</h2>
<p>In signal processing, <strong>integration</strong> and <strong>differentiation</strong> are fundamental operations that allow us to compute displacement from velocity, or acceleration from velocity, among other conversions. These operations are especially critical in seismology, where sensors often record velocity or acceleration and users may need to convert between them.</p>
<p>Numerical integration and differentiation can be performed in both the <strong>time domain</strong> and the <strong>frequency domain</strong>, each with specific advantages and challenges.</p>
<hr />
<h2 id="numerical-integration">Numerical Integration</h2>
<h3 id="1-trapezoidal-rule-integrate_cumtrapz">1. Trapezoidal Rule (<code>integrate_cumtrapz</code>)</h3>
<p><strong>Description</strong>:<br />
Uses the trapezoidal rule to perform cumulative integration of a time series.</p>
<p><strong>Equation</strong>:<br />
For sample spacing Δt:</p>
<p><strong>y[n] = ∫ x(t) dt ≈ y[n-1] + (Δt / 2) * (x[n] + x[n-1])</strong></p>
<p>This method is robust and preserves signal length.</p>
<p><strong>Code Behavior</strong>:</p>
<pre><code class="language-python">ret = scipy.integrate.cumulative_trapezoid(data, dx=dx)
ret = np.concatenate([np.array([0]), ret])
</code></pre>
<hr />
<h3 id="2-spline-based-integration-integrate_spline">2. Spline-Based Integration (<code>integrate_spline</code>)</h3>
<p><strong>Description</strong>:<br />
Creates an interpolating spline of the input signal, and computes the analytical integral of the spline.</p>
<p><strong>Key Parameters</strong>:
- <code>k</code>: spline order (1 = linear, 3 = cubic, up to 5)</p>
<p><strong>Advantages</strong>:
- Smoother result than trapezoidal rule
- Can handle non-uniformities more gracefully</p>
<p><strong>Conceptual Flow</strong>:
1. Fit spline <span class="arithmatex">\( s(t) \)</span> to input data.
2. Compute antiderivative <span class="arithmatex">\( S(t) = ∫ s(t) dt \)</span>
3. Evaluate <span class="arithmatex">\( S(t) \)</span> at each time point.</p>
<hr />
<h2 id="numerical-differentiation">Numerical Differentiation</h2>
<h3 id="3-gradient-method-differentiatemethodgradient">3. Gradient Method (<code>differentiate(method='gradient')</code>)</h3>
<p><strong>Description</strong>:<br />
Calculates the time derivative using central differences (interior) and forward/backward differences at boundaries.</p>
<p><strong>Equation</strong>:<br />
- Interior: <strong>f'[n] ≈ (f[n+1] - f[n-1]) / (2Δt)</strong>
- Boundaries: First-order differences</p>
<p><strong>Function Used</strong>:<br />
<code>numpy.gradient</code></p>
<p><strong>Advantages</strong>:
- Simple and efficient
- Same output shape as input</p>
<hr />
<h2 id="frequency-domain-operations">Frequency Domain Operations</h2>
<h3 id="integration-in-frequency-domain">Integration in Frequency Domain</h3>
<p><strong>Principle</strong>:<br />
Integration corresponds to division by <span class="arithmatex">\( iω \)</span>, where ω = 2πf.</p>
<p><strong>Equation</strong>:
<strong>X(f) → Y(f) = X(f) / (i·2πf)</strong></p>
<h3 id="differentiation-in-frequency-domain">Differentiation in Frequency Domain</h3>
<p><strong>Principle</strong>:<br />
Differentiation corresponds to multiplication by <span class="arithmatex">\( iω \)</span>.</p>
<p><strong>Equation</strong>:
<strong>X(f) → Y(f) = X(f) · (i·2πf)</strong></p>
<p><strong>Caution</strong>:
- Low-frequency components can cause <strong>division by small numbers</strong> (numerical instability)
- Preprocessing such as <strong>highpass filtering</strong> is recommended before integration
- Windowing may help reduce edge artifacts</p>
<hr />
<h2 id="preprocessing-recommendations">Preprocessing Recommendations</h2>
<ul>
<li><strong>Detrending</strong>: Remove any DC offset or trend to avoid ramp artifacts during integration.</li>
<li><strong>Tapering</strong>: Apply a window to reduce edge effects.</li>
<li><strong>Filtering</strong>: Highpass filter before integration to suppress low-frequency drift.</li>
<li><strong>Padding</strong>: Use zero-padding to reduce wrap-around artifacts in frequency-domain operations.</li>
</ul>
<hr />
<h2 id="summary-table">Summary Table</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Domain</th>
<th>Description</th>
<th>Key Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>integrate_cumtrapz</code></td>
<td>Time</td>
<td>Trapezoidal integration</td>
<td>Simple, cumulative, stable</td>
</tr>
<tr>
<td><code>integrate_spline</code></td>
<td>Time</td>
<td>Spline interpolation + integral</td>
<td>Smooth result, adjustable order</td>
</tr>
<tr>
<td><code>differentiate</code></td>
<td>Time</td>
<td>Central differences</td>
<td>Accurate and shape-preserving</td>
</tr>
<tr>
<td>Integration (FFT)</td>
<td>Frequency</td>
<td>Divide by <span class="arithmatex">\( iω \)</span></td>
<td>Powerful but needs careful filtering</td>
</tr>
<tr>
<td>Differentiation (FFT)</td>
<td>Frequency</td>
<td>Multiply by <span class="arithmatex">\( iω \)</span></td>
<td>Ideal for clean signals</td>
</tr>
</tbody>
</table>
<hr />
<p>These tools provide flexible, accurate methods for transforming signals between physical domains (e.g., acceleration ↔ velocity ↔ displacement) in ISP. Each has trade-offs between smoothness, stability, and simplicity.</p>
<hr />
<h2 id="which-integration-method-should-you-use">Which Integration Method Should You Use?</h2>
<p>The best integration method depends on your signal quality, desired precision, and whether you’re working in the time or frequency domain.</p>
<h3 id="trapezoidal-integration-time-domain">Trapezoidal Integration (Time Domain)</h3>
<ul>
<li><strong>Pros</strong>: Simple, fast, intuitive.</li>
<li><strong>Cons</strong>: Accumulates noise and low-frequency drift.</li>
<li><strong>Best For</strong>: Clean, detrended signals; quick and causal applications.</li>
</ul>
<h3 id="spline-integration-time-domain">Spline Integration (Time Domain)</h3>
<ul>
<li><strong>Pros</strong>: Smooth, accurate with noisy or irregular signals.</li>
<li><strong>Cons</strong>: Slightly slower, edge effects possible.</li>
<li><strong>Best For</strong>: Noisy data, offline processing, displacement recovery.</li>
</ul>
<h3 id="frequency-domain-integration">Frequency-Domain Integration</h3>
<ul>
<li><strong>Pros</strong>: Clean handling of frequency components, zero-phase possible.</li>
<li><strong>Cons</strong>: Unstable near 0 Hz, requires preprocessing (detrend, taper, highpass).</li>
<li><strong>Best For</strong>: Band-limited data, spectral pipelines, zero-phase needs.</li>
</ul>
<hr />
<h2 id="recommendation-table">Recommendation Table</h2>
<table>
<thead>
<tr>
<th>Signal Type</th>
<th>Recommended Integration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Clean, low-noise</td>
<td>Trapezoidal</td>
</tr>
<tr>
<td>Noisy or irregular</td>
<td>Spline (e.g., cubic)</td>
</tr>
<tr>
<td>Spectral domain work</td>
<td>Frequency domain</td>
</tr>
<tr>
<td>Requires smooth result</td>
<td>Spline</td>
</tr>
<tr>
<td>Low-frequency drift</td>
<td>Always filter first</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="pro-tip">Pro Tip</h2>
<p><strong>Always</strong>:
- <strong>Detrend</strong>: Remove linear trends
- <strong>Demean</strong>: Remove DC offset
- <strong>Taper</strong>: Smooth edges
- <strong>Highpass Filter</strong>: Suppress long-period drift</p>
<p>These steps are especially crucial before <strong>frequency-domain integration</strong> to avoid numerical artifacts and drift.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>&copy; 2025 <a href="https://robertocabieces.com"  target="_blank" rel="noopener">Roberto Cabieces</a>
</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../javascripts/mathjax.js"></script>
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
