<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Earthquake Location - ISP Tutorial</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/color-brewer.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">ISP Tutorial</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="navitem">
                                <a href="../basics/" class="nav-link">Start with the basics</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">Earthquake Location</a>
</li>
                                    
<li>
    <a href="../tf/" class="dropdown-item">Time-Frequency Analysis</a>
</li>
                                    
<li>
    <a href="../mti/" class="dropdown-item">Seismic Moment Tensor Inversion</a>
</li>
                                    
<li>
    <a href="../aa/" class="dropdown-item">Array Analysis</a>
</li>
                                    
<li>
    <a href="../rf/" class="dropdown-item">Receiver Functions</a>
</li>
                                    
<li>
    <a href="../ant/" class="dropdown-item">Ambient Noise Tomography</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Additional Toolboxes <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../db/" class="dropdown-item">Database</a>
</li>
                                    
<li>
    <a href="../rd/" class="dropdown-item">Retrieve Data</a>
</li>
                                    
<li>
    <a href="../ppsds/" class="dropdown-item">PPSDs</a>
</li>
                                    
<li>
    <a href="../synth/" class="dropdown-item">Synthetic Generator</a>
</li>
                                    
<li>
    <a href="../nrt/" class="dropdown-item">Near Real Time Adquisition</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../refs/" class="dropdown-item">References</a>
</li>
                                    
<li>
    <a href="../license/" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../release_notes/" class="dropdown-item">Release Notes</a>
</li>
                                    
<li>
    <a href="../FAQs.md" class="dropdown-item">FAQs</a>
</li>
                                    
<li>
    <a href="../Special_Thanks/" class="dropdown-item">The Developer Team of ISP thanks to:</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../basics/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../tf/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#earthquake-location" class="nav-link">Earthquake Location</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#pick-event" class="nav-link">Pick Event</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#multimedia-material-pick-event" class="nav-link">Multimedia Material (Pick Event)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#polarisation-analysis" class="nav-link">Polarisation Analysis</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#event-location-and-focal-mechanism-fp" class="nav-link">Event Location and Focal Mechanism (FP)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#earth-model-viewer" class="nav-link">Earth model Viewer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#magnitudes-estimation" class="nav-link">Magnitudes Estimation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="earthquake-location">Earthquake Location</h1>
<p>The module Earthquake analysis allows you to analyse waveforms, polarization analysis of seismograms 3-components, calculate different magnitudes and finally locate an event and estimate the focal mechanism (First Polarity). We will walk through all of the functionality following this scheme:</p>
<h2 id="pick-event">Pick Event</h2>
<p>From top to bottom in the left side of the window you will see:</p>
<ul>
<li>
<p><span style="color:blue"><strong>Event Info</strong></span>: This small box let enter information about an event, in this way you can plot the theoretical arrivals (ak-135F) with respect your seismograms. Plot arrivals requires that you have correctly loaded your metadata.</p>
</li>
<li>
<p><span style="color:blue"><strong>Files Directory</strong></span>: By clicking in this button you will place the path of your files (<em>miniseed). Click on </em><strong>Read Files</strong> to load in an inner database the path to your files. With this action you will be ready to Process and Plot the seismograms. Remember click on Read Files every time you change the folder. Option scan means, scan the whole tree of folders from the root one, to include all possible mseed files paths in the database. Robust means that is going to check that every file in the selected folder is a valid mseed file. </p>
</li>
<li>
<p><span style="color:blue"><strong>Metadata File</strong></span>: By clicking in this button you will place the path to you metadata file. The metadata file must contain the information of all of the stations seismograms you want to analyse (metadata must be a <em>xml or </em>dlsv).</p>
</li>
<li>
<p><span style="color:blue"><strong>Start Time and End Time</strong></span>: The time boxes can be selected checking “Trim Time”. If you choose this option all the seismograms will be cut in accordance with the selected time window. Use the shortcuts "Q" and "E" to set over the plot automatically the trim stat time and endtime.</p>
</li>
<li>
<p><span style="color:blue"><strong>Stations Info</strong></span>: will deploy a table with the fundamental information of the seismograms.</p>
</li>
<li>
<p><span style="color:blue"><strong>Phase box</strong></span>: This combo box allow the selection of specific phases for picking it in the seismograms. </p>
</li>
<li>
<p><span style="color:blue"><strong>Waves box</strong></span>: You can choose Body, surface, coda or noise. With this selected you can highlight a time window of the seismogram for further analysis. For example Mw Magnitude that requires a time window of body wave on many seismograms.</p>
</li>
<li>
<p><span style="color:blue"><strong>Net, Station and Channel</strong></span>: You can fill this boxes (also using wildcards such as * or BH?) to select specific files from your files folder (check “select files”).</p>
</li>
<li>
<p><span style="color:blue"><strong>Stations Map</strong></span>: will show you the location of the stations that corresponds to the seismograms of your folder. The seismograms metadata must match with the metadata information.</p>
</li>
<li>
<p><span style="color:blue"><strong>Rotate</strong></span>: This option will rotate all your station - 3 components (channels must be named N,E,Z) to the Great Arc Circle taking the reference the data of Event info tab. Check "Use this Ang" to rotate the components a specific angle.</p>
</li>
<li>
<p><span style="color:blue"><strong>Cross</strong></span>: This button will compute the cross-correlation (cc) or the autocorrelation of all processed seismograms with respect the reference “Ref”, the number of the seismogram from top to bottom.</p>
</li>
<li>
<p><span style="color:blue"><strong>Process and Plot</strong></span>: This action will read the seismograms from the database of paths to your seismograms, created from your folder tree (database already built using Read Files) and will carry out the processing from the established “MACRO”. Further details in MACRO section "Macros".</p>
</li>
</ul>
<p><img alt="Screenshot" src="../img/explore_catalog.png" /></p>
<p>Additional options from the toolbar are:</p>
<pre><code>                    File
</code></pre>
<p><span style="color:blue">File:</span> <span style="color:red">New location</span> will clean the picks that are saved automatically for be ready to compute new picking/location.
File: Write Files will write in the folder you select the processed seismograms.</p>
<p><span style="color:blue">File:</span> <span style="color:red">Open Settings</span> will open a window with the specific parameters of the subprocess that 
you can carry out in this module (sta/lta, wavelet detection, spectrogram, entropy…).</p>
<p><img alt="Screenshot" src="../img/pick_event_params.png" /></p>
<pre><code>                    Actions
</code></pre>
<p><span style="color:blue">Actions:</span> <span style="color:red"> Picks</span> will open the file with the information of your picks. You can also open the file from here. Shortcut "Ctr + u"</p>
<p><span style="color:blue">Actions:</span> <span style="color:red"> Macro</span> will deploy a window with all of the processing options. All of the processing options will be applied once you press the button Processing and Plot. Shortcut "Ctr + l"</p>
<p><span style="color:blue">Action: </span> <span style="color:red">Detect event</span> will associate the automatic picks carried out by the wavelet picker ant will declare an event. The events will be shown in the seismograms window.</p>
<p><span style="color:blue">Actions: </span> <span style="color:red">Run Picker</span> will carry out the automatic detection/classification of P- and S- waves from the previously loaded “Neural Network”. You must have three components per stations (named <em>N,</em>E,*Z). BE CAREFUL this operation is computationally demanding.</p>
<p><span style="color:blue">Actions: </span> <span style="color:red"> Run Autoloc</span> will detect events using a associated picker based on the Continuous Wavelet Transform (go to File Open Settings to set Num Cycles, Fmin and Fmax) moreover you need to set Detection trigger options Threshold to trigger a pick, number of picks that coincide in different seismograms to declare an event and time window over the clustering of pick is going to be used (For example 40 s means that all seismograms around same time window of 40 s is going to be associated to the same event.</p>
<p>Once an event is declared it is chopped the seismograms run the autopick (P and S wave) using the Neural Network and run and automatic location. If you want to use a local model to locate be sure that you have the travel times calculated. All locations will be storage in ./isp/earthquakeAnalysis/location_output/all_locations.</p>
<p><span style="color:blue">Action: </span> <span style="color:red">Clean Selection</span> will remove an specific seismogram time window selection, such as Body wave,  see the combo box selected and will delete from the selections.</p>
<p><span style="color:blue">Action: </span> <span style="color:red">Remove all selections</span></p>
<p><span style="color:blue">Action: </span> <span style="color:red">Clean Events Detected</span></p>
<p><span style="color:blue">Actions: </span> <span style="color:red">Magnitude Calculator</span> will open a window in which you can compute different magnitudes. For open this you must have estimated an event and have selected the time-windows in the seismograms that you want the magnitudes be calculated.</p>
<p><span style="color:blue">Action: </span> <span style="color:red">Open Earth Model Viewer</span> will open a tool to visualize 3D velocity models. For visualize an Earth Model you need the binary files (<em>buf and  </em>hdr) created in the tab Event location. </p>
<p><span style="color:blue">Action: </span> <span style="color:red">Data availability</span> will plot the data availability (backlines) for each station/component of the database loaded from your folder tree.</p>
<p><span style="color:blue">Action: </span> <span style="color:red">Search in Catalog</span> (see first figure) is a widget designed to plot your catalog and select an event to search in your project. The catalog must be a csv file with this header:</p>
<p>Date;Time;Latitude;Longitude;Depth;Magnitude;mag_type</p>
<p>01/01/2007;02:03:03;34.9608;-4.0459;12.0;2.6;Mw</p>
<p>You can find an example in isp/examples/catalog/catalog_resume. To facilitate the selection of events, the user can press "t" over the epicenter in the map to hilight it in the table. Finally, Pressing button "Select Event" the information is sent to the trim starttime and endtime and to the Event Box. Ready to reload your project to make the search of the event!</p>
<pre><code>                    Compute
</code></pre>
<p>Compute: STA/LTA from all processed seismograms and will plot the result together. STA/LTA takes the parameters from Parameters Settings.</p>
<p>Compute: CWT (CF) from all processed seismograms and will plot the result together. CWT takes the parameters from Parameters Settings.</p>
<p>Compute: Envelope from all processed seismograms and will plot the result together. </p>
<p>Compute: Spectral Entropy from all processed seismograms and will plot the result together. Spectral entropy is estimated in small time windows see Parameters Settings.
.
All Seismograms: Plot together all seismograms.</p>
<p>Stack: Compute (linear, nth-root or PWS) stack of all processed seismograms. Set your choice in File/Open Settings.</p>
<pre><code>                    Go
</code></pre>
<p>Will ship you to the rest of ISP modules (RFs, Array analysis….).</p>
<h2 id="multimedia-material-pick-event">Multimedia Material (Pick Event)</h2>
<p>The following video shows a basic analysis of an earthquake</p>
<!-- blank line -->
<figure class="video_container">
  <video controls="true" allowfullscreen="true" poster="../img/poster_image.png" width="740" height="400">
    <source src="../img/Earthquake_Analysis.mp4" type="video/mp4">
  </video>
</figure>
<!-- blank line -->

<h2 id="polarisation-analysis">Polarisation Analysis</h2>
<p>The Polarization Analysis is designed to analyze the three seismograms components from a station.
You can freely rotate using the rotation RT or the LQT your NEZ components an angle (Rot Angle) with an Incidence angle (Inc Angle).</p>
<p>The Particle motion of the processed seismogram is view clicking in “Plot Polarization”. This option will plot all the time window in a 3D view and in three 2D plot views.</p>
<p>If you want to make a sliding window analysis of the polarization press  “Polarization Analysis”. This will carry out a polarization analysis on windows length and frequency bandwidth specified by the user over the full analyzed seismogram.</p>
<p><img alt="Screenshot" src="../img/polarization.png" /></p>
<p>For a full particle motion analysis, press “Plot Polarization”. This will open another window with a 3D particle motion on the left and the three characteristic views on the right.</p>
<p><img alt="Screenshot" src="../img/polarization2.png" /></p>
<h2 id="event-location-and-focal-mechanism-fp">Event Location and Focal Mechanism (FP)</h2>
<p>In the Event Location Frame the user can configure the velocity grid 1D/3D model, locate earthquakes and compute Focal Mechanisms.</p>
<p><img alt="Screenshot" src="../img/Location.png" /></p>
<p>First it is needed to set a Velocity grid framework (Grid reference and transformation type are mandatory). For now is only available Transformation Simple and Global.</p>
<p>Next, the Grid dimensions (Grid Size). Case 2D the dimension always must be 2 and the grid reference is referred to the corner SW. Case 3D the grid reference is the center of the Grid.
Choose the grid type and the wave and then generate the velocity model binary files by clicking “Generate Velocity Grid”. Please follow the scheme of the next figure to set correctly your grid frame.</p>
<p><img alt="Screenshot" src="../img/frame.png" /></p>
<p>Once the binary files are generated you can check the results in the folder:</p>
<p>ISP/earthquakeAnalysis/location_output/model</p>
<ul>
<li>Where and how place the velocity models?</li>
</ul>
<p>2D models (see example)</p>
<p>LAYER   0.0  6.1 0.0    3.49  0.0  2.7 0.0
LAYER  11.0  6.4 0.0    3.66  0.0  2.7 0.0
LAYER  24.0  6.9 0.0    3.94  0.0  2.7 0.0
LAYER  31.0  8.0 0.0    4.57  0.0  2.7 0.0</p>
<p>ISP/earthquakeAnalysis/location_output/local_models</p>
<p>3D models</p>
<p>ISP/earthquakeAnalysis/location_output/model3D (see example)</p>
<p>Every depth layer must be placed in files called, for example</p>
<p>For the P wave --&gt; layer.P.mod5.mod
For the S wave --&gt; layer.S.mod5.mod</p>
<p>Which means that inside this file there is the grid for the layer at depth 5km.</p>
<p>The layer must be a matrix with the values in the rows from top to bottom S to N and from left to right E to W. That's mean following the next example that the file corresponding to a depth layer 5km "layer.P.mod5.mod" could be like this:</p>
<p>4.5759 4.5735 4.5707 4.5677
4.5760 4.5755 4.5766 4.5670
...... ...... ...... ......
4.6800 4.650 4.67300 4.5678</p>
<p>This matrix means that, for example corresponds to geographic points (separated in cells of, dx dy of 0.5 x 0.5 degrees: Warning grid cells must be [dx = dy = dz] for a correct interpretation.</p>
<p>(-10.0,34) (-9.5,34) (-9.0,34) (-8.5,34)
(-10.0,34.5) (-9.5,34.5) (-9.0,34.5) (-8.5,34.5)
........ ......... ......... .........
(-10.0,40.0) (-9.5,40.0) (-9.0,40.0) (-8.5,40.0)</p>
<p>The most important step is to generate the travel-times for all the stations inside the maximum distance the user determine.  Please be sure that you have load previously the metadata (this Is necessary to associate your picks with your station coordinates.</p>
<p>The generated travel-times will save in </p>
<p>ISP/earthquakeAnalysis/location_output/time, for example with the following name l"ayer.P.EBAD.time.buf"</p>
<p>Once you have complete the above steps you can locate the earthquake and the focal mechanism. The above operation are just necessary to be implemented  the first time you use a specific Earth model.</p>
<p>**For global is not necessary generate the velocity grid and travel times.</p>
<p>To visualize the detailed Probability Density Function, press “Plot PDF” once you have already carried out the location.</p>
<p><img alt="Screenshot" src="../img/PDF.png" /></p>
<p>Moreover, if you have picked the seismic phases and have been designated the polarity in “Event frame” , you will be able to  obtain the Focal Mechanism (it uses the subprogram FocMec)</p>
<h2 id="earth-model-viewer">Earth model Viewer</h2>
<p>The Earth Model Viewer is intended to help to visualize 3D Earth velocity models as Fig 2.8.
Just select the binary file *.buf (can be generated from the model as described in previous section). Next, select the depth of the layer, the cross sections in longitude and latitude and the press plot.</p>
<p><img alt="Screenshot" src="../img/Velocity_Viewer.png" /></p>
<h2 id="magnitudes-estimation">Magnitudes Estimation</h2>
<p>With the Magnitude Estimation you can calculate:
Local Magnitude (ML) or Body-wave (mb), Surface-wave (Ms), Moment Magnitude (Mw) and Coda Magnitude.</p>
<p>To estimate the magnitudes you have to select a time window of body, surface or coda on the seismograms. </p>
<ol>
<li>Units must be on velocity, so you must remove the response of the instrument to velocity, previously to open the Magnitudes window. For Local magnitude you have to remove the response of Wood-Anderson instrument.</li>
<li>The hypocenter must be already calculated. The program will read the *.hyp file before open Magnitudes window.</li>
</ol>
<p>If you place 0.00 on all parameters of local or coda magnitudes, the program will calculate these magnitude with default parameters as follows:</p>
<p>Coda Magnitude:</p>
<p>Values for California
a = 2.0; b = 0.0035; c= -0.87</p>
<p>Mc_value = a<em>np.log10(t_coda)+b</em>dist+c</p>
<p>Local Magnitude:</p>
<p>a = 1.11; b =0.00189; c= -2.09</p>
<p>ML_value = np.log10(max_amplitude)+a<em>np.log10(dist)+b</em>dist+c</p>
<p>Briefly, Once you have open the Magnitude Window, select the magnitudes you want to compute and run the computation.</p>
<p>In the upper panel it is shown the spectrum of the body waves and the fit to calculate the moment magnitude. In the bottom panel is shown the histograms of all magnitudes (the result of the magnitudes for all seismograms for all kind of magnitudes) and on the left an additional plot used to visualize the dispersion of the results.</p>
<p><img alt="Screenshot" src="../img/Magnitudes.png" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
