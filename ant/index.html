<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://projectisp.github.io/ISP_tutorial.github.io/ant/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Ambient Noise Tomography - ISP Tutorial</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/color-brewer.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">ISP Tutorial</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../install/" class="nav-link">Installation</a>
                            </li>
                            <li class="nav-item">
                                <a href="../basics/" class="nav-link">Start with the basics</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Modules</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../el/" class="dropdown-item">Earthquake Location</a>
</li>
                                    
<li>
    <a href="../tf/" class="dropdown-item">Time-Frequency Analysis</a>
</li>
                                    
<li>
    <a href="../mti/" class="dropdown-item">Seismic Moment Tensor Inversion</a>
</li>
                                    
<li>
    <a href="../aa/" class="dropdown-item">Array Analysis</a>
</li>
                                    
<li>
    <a href="../rf/" class="dropdown-item">Receiver Functions</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Ambient Noise Tomography</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Additional Toolboxes</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../db/" class="dropdown-item">Database</a>
</li>
                                    
<li>
    <a href="../rd/" class="dropdown-item">Retrieve Data</a>
</li>
                                    
<li>
    <a href="../ppsds/" class="dropdown-item">PPSDs</a>
</li>
                                    
<li>
    <a href="../synth/" class="dropdown-item">Synthetic Generator</a>
</li>
                                    
<li>
    <a href="../nrt/" class="dropdown-item">Near Real Time Adquisition</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Signal Processing</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../sp_filtering/" class="dropdown-item">Basic Processing Tools</a>
</li>
                                    
<li>
    <a href="../remove_response/" class="dropdown-item">Remove Instrument Response</a>
</li>
                                    
<li>
    <a href="../sp_integrate/" class="dropdown-item">Integrate & Differenciate</a>
</li>
                                    
<li>
    <a href="../sp_denoising/" class="dropdown-item">Denoising</a>
</li>
                                    
<li>
    <a href="../noise_processing/" class="dropdown-item">Noise Processing</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../progress/" class="nav-link">Gallery & Progress</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">About</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../refs/" class="dropdown-item">References</a>
</li>
                                    
<li>
    <a href="../license.md" class="dropdown-item">License</a>
</li>
                                    
<li>
    <a href="../release_notes/" class="dropdown-item">Release Notes</a>
</li>
                                    
<li>
    <a href="../FAQs.md" class="dropdown-item">FAQs</a>
</li>
                                    
<li>
    <a href="../Special_Thanks/" class="dropdown-item">The Developer Team of ISP thanks to:</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../rf/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../db/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#ambient-noise-tomography" class="nav-link">Ambient Noise Tomography</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#egf" class="nav-link">EGF</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#clock-synchronization" class="nav-link">Clock Synchronization</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dispersion-curves" class="nav-link">Dispersion Curves</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dispersion-maps" class="nav-link">Dispersion Maps</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ambient-noise-tomography">Ambient Noise Tomography</h1>
<p>The module ANT is divided in three main parts. First the toolbox designed to retrive Empirical Green Function, second the toolbos designed to measure phase and group velocity from the dispersion curves of EGs and third the toolbox to generate dispersion maps from the previous measurements.
In this tutorial is explained how to manage the module.</p>
<p>We recommend rreading Bensen et al., 2007 to understand the point EGF, Rusell et al., 1988 to understanf the Frequency-Time analysis and the Phase Match Filter,  and Barmin 2001 how to compute the Dispersion Maps.</p>
<hr />
<h2 id="egf">EGF</h2>
<p>1 <span style="color:green">Setting Files Path &amp; Metadata</span></p>
<p>To set the path to the metadata of your network and the path where you have hosted your seismogram files.</p>
<p>First, let's create a project. Set the path where you have the data files. They can be located in any kind of structure, for example in SDS arquitecture (<em>NETWORK/STATION/CHANNEL/FILES</em>) or simply everything in one single folder. WARNING!, create the project can take some time, do not desperate!.
Second, set the path where you have the metadata of all nets/stations/channels yo want to process.</p>
<p>2 <span style="color:green">Setting Parameters for the pre-processing steps of the EGFs</span></p>
<p><img alt="Screenshot" src="../img/egf_settings.png" /></p>
<p>2.1. <span style="color:blue">Processing Box</span></p>
<p><span style="color:#8E44AD">Processing Time Window</span>: This is the time window in seconds that the daily seismograms files will be splitted to save the matrix of noise (see below for more details).</p>
<p><span style="color:#8E44AD">Filter Files</span>: Might be you only want to generate a project for a set of stations "sta1,sta2,sta3..." or a set of channels "BHZ,HHZ". If you want everything just let the space empty.</p>
<p><span style="color:#8E44AD">Remove Instrumet</span>: Set the four corner frequencies (very carefull with nyquist frequency of your data), the water level value and the output units. Even though this operation is computationally demanding, it is fully recommended to deconvolve your instrument to prevent from mixture cross-correlation of data from different instruments.</p>
<p><span style="color:#8E44AD">Decimate</span>: Set the decimation factor. For example if you have HHZ (100hz), a good decimation factor would be 10 to set the new sampling rate to 10 Hz, which is enough to later measure dispersion.</p>
<p><span style="color:#8E44AD">Time Normalization</span>: If is selected a running avarage, a moving median avarage filter of time window selected will be applied. If 1 bit is selected (not recommended) amplitudes will be mapped to (+1, -1).</p>
<p><span style="color:#8E44AD">Spectral Whithening</span>: A moving avarage filter in the amplitude spectrum is applied with a bandwidth selected by the user.</p>
<p>Then set the folder where you want the output of the pre-processing and the EGFs.</p>
<p>2.2. <span style="color:blue">Stack Box</span></p>
<p><span style="color:#8E44AD">Components</span>: Select the components that you want to cross correlate and stack. This operation allows ISP just select specific noise matrix to boost the speed of the stack.</p>
<p><span style="color:#8E44AD">Stacking Method</span>:Select amoung Phase Wave stack, Linear and nth-root stack. Personally we recommend go for linear if you have several months of data and go for PWS if you have just few . Nth-rooth for testing and comparison with linear. The parameter is the power of the method in PWS or Nrooth (Do not change from 2 :-))</p>
<p><span style="color:#8E44AD">Maximum Intedistance</span>: Because sometimes we do not want to mix EGFs with very long interdistance with short distance, ISP allows the user to filter the cross correlation and stack computation by maximum interdistance value.</p>
<p><span style="color:#8E44AD">Check Noise Matrix Output</span>: If the user check <em>Compute daily Stacks</em>, ISP will compute the evolution of the EGFs in partial stacks of 20 days. If <em>Include Autocorrelations and Shifted Cross Correlations</em>, ISP will estimate all pssoble cross-correlations including autocorrelations e.g., ZZ and both cross-correlations (e.g., ZE and EZ). This option is mandatory to be checked if you want go for Transversal components to estimate dispersion curves of Love Waves.</p>
<p>3 <span style="color:green">Run pre-processing</span></p>
<p>Now, click on Run pre-processing. This action will load your settings and will make a database of the available files. Then the process will start to process the data.
    Finally per every station/channel a file will be saved containing a matrix with the noise data in frequency domain, ready to cross-correlate.</p>
<p>4 <span style="color:green">Run Stack</span></p>
<p>This action will load files from the pre-processing step and then for every channel-channel combination will do a cross correlation and stack all the stacks will be saved in the .outpur_directory/stack.</p>
<!-- blank line -->
<p><img alt="Screenshot" src="../img/egfs.png" /></p>
<!-- blank line -->

<p>5 <span style="color:green">Explore your EGFs</span></p>
<p>In this point the user can set the path to the output files (hdf5 or sac files), read the files and then <em>process and plot</em>. The user can also establish a Macro to process the EGFs, plot a map and sort the EGFs by inter station distance. Notice that autocorrelations will be 0 distance.</p>
<p><span style="color:#8E44AD">Set Path</span> Set the path to your stack output directory.</p>
<p><span style="color:#8E44AD">Read Files</span> create a list ready to process and plot of the available stack EGF in the folder. If Sort is checked, the files will be sorted by inter-station distance or backazimth.</p>
<p><span style="color:#8E44AD">Process and Plot</span> Process the EGFs of the list according to the macro previously established and then plot.</p>
<p>6 <span style="color:green">Explaining the output</span></p>
<p>When the user compute the preprocess, all information is saved in Noise Matrix per station/channel. The noise matrid is a 3D matrix in whic the first dimension or the rows are consecutive time windows of an split day, the seconddimension or the colums are the day and the third dimension or depth is the complex numers corresponding to the processed spectrum of the noise window. The matrix is saved as pickle with name "NWTSTACHANNEL". The matrix includes a column daily header "[julday1.year1",julday2.year1, .... ] and a numpy arrayy with the spectral information.</p>
<p>Afterwards, when the user press cross and stack, ISP combines the matrix information ifft(matrix_A*cong(matrix_B)) and then stack. </p>
<p>Stack files shoul be named as follows "NET.STA1_STA2.CHN1CHN2". The stack files have format hdf5, basically a mseed with extra header info (e.g., inter-distance or inter-azimuth).</p>
<p>Stack_daily files are partial stacks with this aspect "NET.STA1_STA2.CHN1CHN2_daily", They are part of the output and basically are partial stacks of noise windows of 20 days shifted by default 10 days (50%). This is very useful to both, monitorize the evolution of noise and to synchonize Ocean Bottom Seismometers.</p>
<pre>
    <code>
output_dir/matrix_files
outout_dir/stack/
output_dir/stack_daily/
output_dir/stack_rotated/
    </code>
</pre>

<hr />
<h2 id="clock-synchronization">Clock Synchronization</h2>
<p>Clock Synchonization is very easy using ISP. Just select the station pair you want to synchronize <span style="color:#8E44AD">Search file</span> and th process (take the parameters from the macro) and plot <span style="color:#8E44AD">Plot Daily Correlations</span>. This action will be show the evolution of noise in partial stacks of 20 days. Now you can chop the signal pressing "q" for starttime and "e" and then check the trim box. </p>
<p>Now select how do you want to fit your data, normaly a straight line but you can choose a plynom of degree up to 6. Press <span style="color:#8E44AD">sync</span>
Finally click and drag with the mouse and draw a free line over the points to be selected. Finally press enter. The output will be saved as a <span style="color:#8E44AD">pickle dictionary</span>:</p>
<pre>
    <code>
isp/ant/clock_dir/STA1_STA2
where
STA1_STA2 keys = {clocks_station_name, Dates, Drift, Ref, R2}
    </code>
</pre>

<p><img alt="Screenshot" src="../img/Clock_Drift.png" /></p>
<hr />
<h2 id="dispersion-curves">Dispersion Curves</h2>
<p>Once you have generated the EGFs, it is time to measure the dispersion curves (phase and group velocity). We are going to explain how to use this module step by step.</p>
<p>1 <span style="color:green">Creating a Project</span></p>
<p>First of all, create a project by clicking in the upper diplaying pannels "Dispersion Curves/Manage Project" then will pop up this widget:</p>
<p><img alt="Screenshot" src="../img/Project_Disp.png" /></p>
<p>Ok, now set the path where you want to create the project and give it a name, next <span style="color:#8E44AD">Create New Project</span>. You will find an example of project at ant/disp_maps.pkl, that it is just a dicctionary with the information of the dispersion measurements. Later I will show you that this project is the entry to plot the Dispersion Maps.</p>
<p>2 <span style="color:green"><strong>Time to measure dispersion</strong></span> </p>
<p>You can configurate your window as the figure below. Start with general configuration:</p>
<p><span style="color:blue"><strong>Settings</strong></span>:</p>
<p><span style="color:#8E44AD">Causal/Acausal</span>: part of the quasi-symmetric EGF. This is the part that will be analyze in the process.</p>
<p><span style="color:#8E44AD">Rayleigh/Love</span>: wave that will be saved to the project for info. Normally the user should select Raylegh for EGFs retrived from the verical components between pair of stations and Love for the horizontals.</p>
<p><span style="color:blue"><strong>Process Phase and Group Velocity</strong></span>:</p>
<p><span style="color:#8E44AD">Files Directory</span>: Place the path where you have the stack files (see point 6 of the previous section).</p>
<p><span style="color:#8E44AD">Macros</span>: Place the processing steps you with to apply to your EGF.</p>
<p><span style="color:#8E44AD">Method</span>: For now tested Continuos Wavelet Transform with the Morlet Wavelet and using number of cycles 6 (perfect match between Fourier frequency and wavelet scales).</p>
<p><span style="color:#8E44AD">Min level</span>: Set the minimum water level you want for your Frequency-Time analysis in Group Velocity</p>
<p><span style="color:#8E44AD">Phase Match Filter</span>: This filter is applied to measure Group Velocity and basically takes a "Ref Disp Curve" and try to match it with your actual Dispersion curve. if you decide apply it you will notice the effect in both the time domain right pannel and in the Frequency-Time Group velocity pannel.</p>
<p><span style="color:#8E44AD">Process first Group then Phase velocity</span>: Once It is plot the Time-Frequency plane of Group velocity (central pannel), the you can click (left button) and drag with your mouse to draw a free style line selecting all points that you consider for saving later. Once you close the draw, that point will appear in purple. Now, press process Phase velocity. You will see kind of several parallel curves. Same thing, click and drag to select all point with the same color.</p>
<p><img alt="Screenshot" src="../img/Dispersion_Curves.png" /></p>
<p>3 <span style="color:green"><strong>Save your stuff in your Project</strong></span></p>
<p><span style="color:#8E44AD">Save to Project</span>: the dispersion measurements of Phase and Group Velocity. Once it is saved into the project, ISP wil check the box correspong to the file and print in the terminal.</p>
<p><span style="color:#8E44AD">Remove from Project</span>: a measurement just highlighting a checked file and press this button to remove the wrong measure from your project.</p>
<hr />
<h2 id="dispersion-maps">Dispersion Maps</h2>
<p>In a very simple way you will plot Dispersion Maps.</p>
<p><span style="color:#8E44AD">Set the path to your project</span>: Remind you that you have available an example at isp/anddisp_maps.pkl.</p>
<p>Now you must tell ISP where to find the information you want to plot. You can do it as follows:</p>
<p><span style="color:#8E44AD">Select the wave type</span> Vertical/Rayleigh Wave Hrizontal/Love Wave</p>
<p><span style="color:#8E44AD">Dispersion type</span> Group/Phase Velocity</p>
<p>Then, set some parametriztion related to resolution and smoothing</p>
<p><span style="color:#8E44AD">Dispersion Maps Parameters</span>: Set the minimum and maximum Period in which to want to compute the analysis or just check all periods to compute everything possible inside your project.</p>
<p><span style="color:#8E44AD">Period Step</span>: It is the period step in which you want to compute every map. Every One second is more than enougth do not be crazy! :-).</p>
<p><span style="color:#8E44AD">Grid resolution</span>: It is is the estimated spatial resolution that you expect for your maps. It depends on the geometry of your network, the interdistance and the maximum distance between staion pairs.</p>
<p><span style="color:#8E44AD">Dispersion Maps Smoothing Parameters</span> (see Barmin 2001 to understand the effect of the regularization parameters). Our own advice is if you want high detail go foe a = 600, but if you want high smoothing go for a = 1000. Let b = 10 and gamma = 100.</p>
<p>We are developing the resolution maps and checkboard test. Just give us a chance</p>
<p><img alt="Screenshot" src="../img/dispersion_maps.png" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>&copy; 2025 <a href="https://robertocabieces.com"  target="_blank" rel="noopener">Roberto Cabieces</a>
</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../javascripts/mathjax.js"></script>
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
